# UI主题与组件规范

本文档旨在为 Peers Touch 桌面应用建立一套统一、规范的UI设计与代码实现标准。所有开发者在实现UI时，都应严格遵循本文档中定义的规则，以确保应用的视觉一致性、代码的可维护性和未来的可扩展性（如主题切换）。

## 核心原则

1.  **禁止硬编码**：严禁在组件中硬编码任何颜色（`Color(0xFF...)`）、字号（`fontSize: 14`）、边距（`padding: EdgeInsets.all(8)`）等视觉相关的“魔法数字”。
2.  **主题驱动**：所有视觉元素都必须通过 `Theme.of(context)` 来获取。颜色应使用 `Theme.of(context).colorScheme`，文本样式应使用 `Theme.of(context).textTheme`。
3.  **语义化命名**：在主题中定义的颜色和样式，应采用“语义化”的命名，描述其用途而非颜色值。例如，使用 `primary`、`onSurface`、`caption`，而不是 `blue`、`white`、`greyText`。
4.  **组件封装**：通用的UI模式（如带图标的按钮、标准卡片）应被封装为可复用的Widget，并统一存放在 `lib/core/components/` 目录下。

## 1. 颜色规范 (Color Scheme)

所有颜色都通过 `ThemeData` 的 `colorScheme` 扩展来定义和使用。我们基于Material 3的颜色系统，并根据我们的品牌风格进行定制。

### 核心颜色角色

| 角色 | 用途描述 |
| :--- | :--- |
| `primary` | 品牌主色，用于关键交互元素，如按钮、激活状态的图标。 |
| `onPrimary` | 在 `primary` 颜色之上的内容颜色（文本、图标）。 |
| `surface` | 界面的基础“纸张”颜色，用于卡片、菜单等组件的背景。 |
| `onSurface` | 在 `surface` 颜色之上的主要内容颜色。 |
| `background` | 应用窗口或页面的最底层背景色。 |
| `onBackground`| 在 `background` 颜色之上的内容颜色。 |
| `secondary` | 次要的强调色，用于次级按钮、标签等。 |
| `outline` | 用于组件的边框，如输入框、卡片描边。 |
| `error` | 表示错误的颜色，用于错误提示文本、校验失败的输入框。 |

### 如何在代码中使用颜色

```dart
// 正确示例
Container(
  color: Theme.of(context).colorScheme.surface,
  child: Text(
    'Hello',
    style: TextStyle(color: Theme.of(context).colorScheme.onSurface),
  ),
);

// 错误示例
Container(
  color: Colors.white,
  child: Text(
    'Hello',
    style: TextStyle(color: Colors.black),
  ),
);
```

## 2. 文本规范 (Text Theme)

所有文本样式都通过 `ThemeData` 的 `textTheme` 来定义和使用。我们基于Material 3的排版系统，定义了不同层级的文本样式。

### 核心文本角色

| 角色 | 建议字号/字重 | 用途描述 |
| :--- | :--- | :--- |
| `displayLarge` | 57.0 / w400 | 用于巨型标题，如欢迎页的Slogan，很少使用。 |
| `headlineLarge`| 32.0 / w400 | 用于页面的主标题。 |
| `titleLarge` | 22.0 / w400 | 用于对话框、卡片等容器的标题。 |
| `bodyLarge` | 16.0 / w400 | 用于正文内容，是应用中最常用的文本样式。 |
| `bodyMedium` | 14.0 / w400 | 次要的正文或描述性文本。 |
| `labelLarge` | 14.0 / w500 | 用于按钮、标签等交互组件的文本。 |
| `bodySmall` | 12.0 / w400 | 辅助性、说明性的文本，如提示、时间戳。 |
| `labelSmall` | 11.0 / w500 | 非常小的标签文本。 |

### 如何在代码中使用文本样式

```dart
// 正确示例
Column(
  children: [
    Text('Page Title', style: Theme.of(context).textTheme.headlineLarge),
    Text('This is the body text.', style: Theme.of(context).textTheme.bodyLarge),
  ],
);

// 错误示例
Column(
  children: [
    Text('Page Title', style: TextStyle(fontSize: 32, fontWeight: FontWeight.w400)),
    Text('This is the body text.', style: TextStyle(fontSize: 16)),
  ],
);
```

## 3. 间距与尺寸规范

为保证UI的节奏感和一致性，所有间距和尺寸应基于一个`8px`的基准网格系统。

- **组件内边距 (Padding)**：推荐使用 `8px`, `16px`, `24px`。
- **组件间间距 (Margin/SizedBox)**：推荐使用 `8px`, `16px`, `24px`, `32px`。
- **圆角 (BorderRadius)**：推荐使用 `4px`, `8px`, `12px`，或全圆角 `999px`。

### 如何在代码中实现

建议在 `core/constants` 中定义间距常量，方便统一调用和修改。

```dart
// 建议在 app_constants.dart 中定义
class AppConstants {
  static const double paddingSmall = 8.0;
  static const double paddingMedium = 16.0;
  static const double paddingLarge = 24.0;
}

// 在组件中使用
Padding(
  padding: const EdgeInsets.all(AppConstants.paddingMedium),
  child: //...
)
```

## 4. UI组件库

所有可复用的UI组件都应存放在 `lib/core/components/` 目录下。当一个UI模式在应用中出现超过两次时，就应该考虑将其封装成一个独立的、可配置的Widget。

**组件示例**：

- `CommonButton`: 标准按钮，可配置样式（主按钮、次要按钮、文本按钮）。
- `CommonCard`: 标准卡片容器，内置了符合规范的圆角、阴影和内边距。
- `CommonInputField`: 标准输入框，集成了标签、错误提示和校验逻辑。

---

**这份文档是动态的，会随着项目的发展而不断完善。请所有开发者在开始新的UI工作前，务必重新阅读并遵循最新规范。**

## 5. WeChat 风格暗黑主题（统一 tokens）

为避免在业务模块中硬编码视觉参数，我们通过 `ThemeExtension` 提供微信风格的暗黑主题 tokens（已在 `AppTheme` 接入）。

### 可用 tokens（`WeChatTokens`）
- 颜色层级：`bgLevel0`（窗口底色）、`bgLevel1`（内容区）、`bgLevel2`（容器/侧栏）、`bgLevel3`（输入/列表项）
- 文本：`textPrimary`、`textSecondary`、`textTertiary`
- 分隔：`divider`
- 品牌与状态：`brandAccent`（#07C160）、`menuSelected`
- 间距：`spaceXs/Sm/Md/Lg/Xl`
- 圆角：`radiusSm/Md/Lg`

### 使用示例
```dart
final tokens = Theme.of(context).extension<WeChatTokens>()!;

Container(
  margin: EdgeInsets.all(tokens.spaceSm),
  padding: EdgeInsets.all(tokens.spaceSm),
  decoration: BoxDecoration(
    color: tokens.bgLevel2,
    borderRadius: BorderRadius.circular(tokens.radiusMd),
    border: Border.all(color: tokens.divider),
  ),
  child: Text('统一样式', style: TextStyle(color: tokens.textPrimary)),
);
```

> 规则：所有颜色、间距、圆角一律从 `WeChatTokens` 读取；业务组件不得出现 `Color(...)` 与随意数字。这样即可实现“统一地方控制”，并能全局替换主题而无需改动各模块。

## 6. 组合组件：框 + 按钮（统一搜索/操作模式）

- 适用场景：侧栏搜索框与紧邻的操作按钮（如“新建”）。
- 高度：与一级菜单选中边框的盒子高度一致（`menuBarWidth * menuItemBoxRatio`）。
- 边框：与一级菜单选中态一致，使用 `tokens.divider` + `1px`。
- 宽度：输入框占据剩余空间，右侧按钮为等高正方形。

### 组件与示例
组件：`lib/core/components/frame_action_combo.dart`

```dart
// 在侧栏顶部使用（AI 会话列表）
Padding(
  padding: EdgeInsets.symmetric(horizontal: UIKit.spaceMd(context)),
  child: FrameActionCombo(
    hintText: AppLocalizations.of(context).chatSearchSessionsPlaceholder,
    prefixIcon: Icons.search,
    onAction: onNewChat, // 可选：不传则不显示按钮
    actionIcon: Icons.add,
  ),
);

// 在设置页左侧搜索（无按钮）
FrameActionCombo(
  hintText: '搜索设置', // 未来迁移到 i18n
  prefixIcon: Icons.search,
  onChanged: controller.setSearchQuery,
);
```

> 统一规范：高度、边框、圆角与间距均通过 `WeChatTokens`/`UIKit` 读取，禁止硬编码。该组合组件应作为侧栏类搜索与操作的默认实现。