# 桌面端功能建设蓝图（简版）

> 范围：仅针对 `peers-touch/desktop` 项目，遵循 Base Prompt（PROJECT_BASE_PROMPT.zh.md）。
>
> 目标：以功能落地为中心，清晰表达建设所需的模块、交互、状态、路由、数据、测试与验收等要点，便于快速交付。

## 一、基本约束（与 Base 对齐）
- 视图：`StatelessWidget`，状态全部由 `GetX Controller` 管理。
- 路由与依赖：使用 `GetX`（`app_routes.dart`、`app_pages.dart`、`xxx_binding.dart`）。
- 引用：绝对路径 `import`，模块自包含（view/controller/model/binding）。
- 共享：全局复用能力在 `core/`，业务级共享在 `features/shared/`。

## 二、核心功能模块与重点
- Shell 三栏框架（`ShellThreePane`）
  - 左栏：可拖拽宽度、内部滚动。
  - 中栏：自适应，消息/列表内部滚动，无最大宽约束。
  - 右栏：可拖拽宽度，统一滚动托管（垂直+水平），支持嵌入模式。
- AIChat
  - 中栏消息列表自身滚动；右栏扩展面板承载 Profile/Settings 等嵌入页面。
  - 与 Shell 统一滚动/拖拽策略一致，避免双层滚动冲突。
- Profile
  - 嵌入模式返回“裸内容”，滚动和边距由右栏统一托管。
  - 非嵌入（独立页）保留居中与最大宽（`UIKit.contentMaxWidth`）。
- Settings
  - 两栏布局（导航/内容）；在右栏嵌入时遵守统一滚动与宽度约束。
- Core Components / UI Kit
  - 统一尺寸、色彩、节奏与分隔规则；常量与样式集中管理（`app/theme`、`UIKit`）。

## 三、交互与 UI 要点
- 右栏
  - 拖拽柄宽度一致；有最小/最大宽（如 `UIKit.rightPanelMinWidth/MaxWidth`）。
  - 内容滚动统一托管：垂直 + 水平，承载可能溢出的注入内容。
- 溢出处理
  - 所有嵌入页面不得自建外围滚动；超宽内容依赖右栏的水平滚动。
- 可视与节奏
  - 统一标题层级与分隔策略（见 `secondary_page_title_policy.zh.md` 与 `10.ui_header_rhythm_and_divider.zh.md`）。

## 四、状态、数据与服务
- 控制器
  - 仅在 `Controller` 中维护 `Rx/RxList/RxBool` 等状态；视图通过 `Obx/GetBuilder` 订阅。
- 模型
  - 明确 `model/` 结构；包含 `fromJson/toJson`，不承载业务逻辑。
- 服务
  - 网络：`dio` 封装（拦截器/异常）；响应模型统一。
  - 本地：`get_storage` 封装（键常量集中在 `core/constants`）。

## 五、路由与导航
- 统一在 `app_routes.dart` / `app_pages.dart` 注册。
- 打开右栏扩展以嵌入页面（如 `ProfilePage`、`SettingsPage`）而非新路由，遵守 Shell 约束。

## 六、国际化与文案
- 放置在 `app/i18n/`，所有字符串通过 `locale_keys.dart` 的常量访问；避免硬编码。

## 七、主题与视觉
- `app_theme/app_styles` 统一主题；UI Kit 管理尺寸/半径/间距等常量。
- 动画与层级：在 `global_ui_animation_dimension` 与 `global_ui_visual` 的通用规则下实现。

## 八、错误、异常与安全
- 网络异常统一处理；视图不直接捕捉业务错误，而是显示 Controller 暴露的状态。
- 隐私设置（Profile）与权限策略在 Controller 中实现；视图仅绑定状态与事件。

## 九、性能与优化
- 避免双层滚动与重复布局；长列表使用高效构建（如 `ListView.builder`）。
- 控制器与服务惰性注入；释放生命周期资源（`onClose`）。

## 十、测试与验收清单（重点）
- Shell 右栏
  - 拖拽柄可用；最小/最大宽生效；内容双向滚动可用。
- AIChat
  - 中栏消息滚动流畅；右栏打开/关闭状态正确，嵌入页面不出现双滚动。
- Profile
  - 嵌入模式返回裸内容；非嵌入居中与最大宽正确。
- Settings
  - 两栏导航与内容区域在右栏嵌入时可用；滚动统一由 Shell 托管。
- 路由与依赖
  - 所有页面通过 `GetPage` 注册；绑定使用 `Get.lazyPut`；引用为绝对路径。

## 十一、交付顺序建议
1) 完成 Shell 三栏与右栏统一滚动托管（含水平溢出）。
2) AIChat 集成右栏扩展（打开/关闭/拖拽）。
3) Profile 嵌入模式适配与验收。
4) Settings 右栏嵌入适配与验收。
5) 回归测试与可视规范检查；准备发布。

## 十二、风险与回滚
- 若页面仍内置滚动导致冲突：移除内部 `SingleChildScrollView`，改用容器填充。
- 右栏超宽内容若不可滚动：检查双向滚动容器是否正确包裹。

## 十三、关联与参考
- Base Prompt：`desktop/PROJECT_BASE_PROMPT.zh.md`
- 相关现有 Prompt：
  - `PROMPTs/2.global_ui_skeleton.zh.md`
  - `PROMPTs/3.global_ui_components.zh.md`
  - `PROMPTs/4.global_ui_kit_and_theme.zh.md`
  - `PROMPTs/7.dependency_injection_binding.zh.md`
  - `PROMPTs/8.module_development_sop.zh.md`
  - `PROMPTs/9.feature_profile.zh.md`
  - `PROMPTs/1.feature_settings.zh.md`
  - `PROMPTs/1.ai_chat.zh.md`